{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<div class="flex flex-col md:flex-row gap-6 mt-10 max-w-5xl mx-auto">
  <!-- Left pane: Circle Members -->
  <div class="md:w-1/2 bg-white rounded shadow p-6">
    <h2 class="text-2xl font-bold mb-4">Your Circle Members</h2>
    <table class="min-w-full mb-6">
      <thead>
        <tr class="border-b">
          <th class="px-4 py-2 text-left">Name</th>
          <th class="px-4 py-2 text-left">Email</th>
          <th class="px-4 py-2 text-left">SMS Number</th>
          <th class="px-4 py-2">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for cm in circle_members %}
        <tr class="border-b {% if selected_cm and cm.pk == selected_cm.pk %}bg-blue-100{% endif %}">
          <td class="px-4 py-2">
            <a href="?circle_member_id={{ cm.pk }}" class="{% if selected_cm and cm.pk == selected_cm.pk %}font-bold{% endif %}">{{ cm.name }}</a>
          </td>
          <td class="px-4 py-2">{{ cm.email }}</td>
          <td class="px-4 py-2">{{ cm.sms_number }}</td>
          <td class="px-4 py-2">
            <a href="{% url 'reminders:edit_circle_member' cm.pk %}" class="text-blue-600 underline mr-2">Edit</a>
            <form action="{% url 'reminders:delete_circle_member' cm.pk %}" method="post" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="text-red-600 underline bg-transparent border-none p-0 m-0" style="cursor:pointer;">Delete</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="4" class="text-gray-500 px-4 py-2">No Circle Members yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
    <h3 class="text-xl font-semibold mb-2">Add a New Circle Member</h3>
    <form method="post" class="space-y-4">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit" name="add_circle_member" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Add</button>
    </form>
  </div>
  <!-- Right pane: Medication Regimes for selected Circle Member -->
  <div class="md:w-1/2 bg-white rounded shadow p-6">
    {% if selected_cm %}
      <h2 class="text-2xl font-bold mb-4">Medication Regimes for {{ selected_cm.name }}</h2>
      <table class="min-w-full mb-6">
        <thead>
          <tr class="border-b">
            <th class="px-4 py-2 text-left">Natural Language Description</th>
            <th class="px-4 py-2">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for regime in regimes %}
          <tr class="border-b">
            <td class="px-4 py-2">{{ regime.natural_language_description|default:"(No description)" }}</td>
            <td class="px-4 py-2">
              <!-- Edit/Delete actions to be added -->
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="2" class="text-gray-500 px-4 py-2">No Medication Regimes yet.</td></tr>
          {% endfor %}
        </tbody>
      </table>
      <h3 class="text-xl font-semibold mb-2">Add a New Medication Regime</h3>
      <form method="post" class="space-y-4">
        {% csrf_token %}
        {{ regime_form.as_p }}
        <button type="submit" name="add_regime" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Add Regime</button>
      </form>
    {% else %}
      <div class="text-gray-500">Select a Circle Member to view their Medication Regimes.</div>
    {% endif %}
  </div>
</div>
{% endblock %}
